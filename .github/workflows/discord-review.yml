name: Discord Notifications

on:
  pull_request_review:
    types: [submitted]
  pull_request_review_comment:
    types: [created]

env:
  hwinkr: "@í•´ë¦¬"

jobs:
  notify_review:
    runs-on: ubuntu-latest

    steps:
      - name: ìƒˆë¡œìš´ í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ë·°ê°€ ë“±ë¡ë˜ë©´ í”„ë¡ íŠ¸ì—”ë“œ ì±„ë„ì— ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.pull_request.title, '[FE]')
        env:
          FE_DISCORD_WEBHOOK_URL: ${{ secrets.FE_DISCORD_WEBHOOK_URL }}
        run: |
          REVIEWER=$(jq -r '.review.user.login' < $GITHUB_EVENT_PATH)
          REVIEWER_MENTION=$(printenv $REVIEWER)
          if [ -z "$REVIEWER_MENTION" ]; then
            REVIEWER_MENTION=$REVIEWER
          fi
          REVIEWER_LINK="[${REVIEWER_MENTION}](https://github.com/${REVIEWER})"
          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ’¬ ${REVIEWER_LINK}ë‹˜ì´ ìƒˆë¡œìš´ ë¦¬ë·°ë¥¼ ë‚¨ê²¼ì–´ìš”! ë¦¬ë·°ë¥¼ ë°˜ì˜í•´ ì£¼ì„¸ìš”.\n\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“„ **ì œëª©**: ${{ github.event.pull_request.title }}\"}" \
          $FE_DISCORD_WEBHOOK_URL

      - name: ìƒˆë¡œìš´ ë°±ì—”ë“œ ë¦¬ë·°ê°€ ë“±ë¡ë˜ë©´ ë°±ì—”ë“œ ì±„ë„ì— ë””ìŠ¤ì½”ë“œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
        if: contains(github.event.pull_request.title, '[BE]')
        env:
          BE_DISCORD_WEBHOOK_URL: ${{ secrets.BE_DISCORD_WEBHOOK_URL }}
        run: |
          REVIEWER=$(jq -r '.review.user.login' < $GITHUB_EVENT_PATH)
          REVIEWER_LINK="[${REVIEWER}](https://github.com/${REVIEWER})"
          curl -H "Content-Type: application/json" \
          -d "{\"content\": \"ğŸ’¬ ${REVIEWER_LINK}ë‹˜ì´ ìƒˆë¡œìš´ ë¦¬ë·°ë¥¼ ë‚¨ê²¼ì–´ìš”! ë¦¬ë·°ë¥¼ ë°˜ì˜í•´ ì£¼ì„¸ìš”.\n\nğŸ”— [PR ë§í¬](${{ github.event.pull_request.html_url }})\nğŸ“„ **ì œëª©**: ${{ github.event.pull_request.title }}\"}" \
          $FE_DISCORD_WEBHOOK_URL
